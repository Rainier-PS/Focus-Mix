<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <!-- SEO title (60–65 characters) -->
  <title>Focus Mix — Quick Allergy Test & Personalized Snack Recommendations</title>

  <!-- Meta description (155–160 characters) -->
  <meta name="description" content="Take the Focus Mix quick allergy screening and get personalized snack recommendations tailored to your needs." />

  <!-- Keywords (optional but useful for niche targeting) -->
  <meta name="keywords" content="allergy test, snack recommendation, healthy snacks, Focus Mix" />

  <!-- Canonical URL -->
  <link rel="canonical" href="https://yourdomain.com/" />

  <!-- Favicon -->
  <link rel="icon" href="/favicon.ico" />

  <!-- Open Graph / Facebook -->
  <meta property="og:title" content="Focus Mix — Quick Allergy Test & Personalized Snack Recommendations" />
  <meta property="og:description" content="Fast, easy allergy screening with personalized snack suggestions. Try Focus Mix now." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://yourdomain.com/" />
  <meta property="og:image" content="https://yourdomain.com/preview.jpg" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Focus Mix — Quick Allergy Test & Personalized Snack Recommendations" />
  <meta name="twitter:description" content="Fast, easy allergy screening with personalized snack suggestions. Try Focus Mix now." />
  <meta name="twitter:image" content="https://yourdomain.com/preview.jpg" />

  <!-- Tailwind Play CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Tailwind config for rounded, shadows, and dark mode using class strategy
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          borderRadius: { 'xl': '1rem' },
          boxShadow: { 'soft': '0 6px 18px rgba(8,15,29,0.08)' }
        }
      }
    }
  </script>
  <style>
    /* small extra styles for accessibility visuals */
    .rating-radio:focus + label { outline: 3px solid rgba(99,102,241,0.25); }
    .sr-only-focusable:focus:not(:focus-visible) { outline: none; }
  </style>
</head>
<body class="bg-gray-50 dark:bg-gray-950 text-gray-900 dark:text-gray-100 min-h-screen flex items-center justify-center p-4">
  <main class="w-full max-w-2xl">
    <section class="bg-white dark:bg-gray-900 rounded-2xl shadow-soft p-6 md:p-8">
      <header class="flex items-start justify-between gap-4">
        <div>
          <h1 class="text-2xl md:text-3xl font-semibold">Focus Mix — Quick Match</h1>
          <p class="mt-1 text-sm text-gray-600 dark:text-gray-400">Complete a short, safe test and get a personalized trail-mix recommendation.</p>
        </div>
        <div class="flex items-center gap-2">
          <button id="themeToggle" class="inline-flex items-center gap-2 px-3 py-1.5 rounded-xl border dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline-none" aria-pressed="false">
            <svg id="themeIcon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zM4.22 4.22a1 1 0 011.42 0l.7.7a1 1 0 11-1.42 1.42l-.7-.7a1 1 0 010-1.42zM2 10a1 1 0 011-1h1a1 1 0 110 2H3a1 1 0 01-1-1zM4.22 15.78a1 1 0 010-1.42l.7-.7a1 1 0 011.42 1.42l-.7.7a1 1 0 01-1.42 0zM10 16a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM15.78 15.78a1 1 0 01-1.42 0l-.7-.7a1 1 0 011.42-1.42l.7.7a1 1 0 010 1.42zM17 10a1 1 0 01-1 1h-1a1 1 0 110-2h1a1 1 0 011 1zM15.78 4.22a1 1 0 010 1.42l-.7.7A1 1 0 0113.96 4.9l.7-.7a1 1 0 011.42 0z" /></svg>
            <span class="text-sm">Theme</span>
          </button>
        </div>
      </header>

      <form id="mixForm" class="mt-6 grid gap-6" novalidate>
        <!-- Allergy screening -->
        <fieldset class="p-4 bg-gray-50 dark:bg-gray-800 rounded-xl" aria-labelledby="allergyLegend">
          <h3 id="allergyLegend" class="text-lg font-medium mb-2">
            Allergy screening 
            <span class="text-sm text-gray-500 dark:text-gray-400">(required)</span>
          </h3>
          <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">
            Please check any you are allergic to. If you are allergic to any ingredient listed, we will offer a safe alternative.
          </p>

          <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-2">
            <label class="inline-flex items-center gap-2">
              <input type="checkbox" name="allergies" value="nuts" class="allergy h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" />
              <span>Nuts (almonds, cashews)</span>
            </label>
            <label class="inline-flex items-center gap-2">
              <input type="checkbox" name="allergies" value="chocolate" class="allergy h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" />
              <span>Chocolate</span>
            </label>
            <label class="inline-flex items-center gap-2">
              <input type="checkbox" name="allergies" value="driedfruit" class="allergy h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" />
              <span>Dried fruit</span>
            </label>
            <label class="inline-flex items-center gap-2">
              <input type="checkbox" name="allergies" value="matcha" class="allergy h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" />
              <span>Matcha / Caffeine</span>
            </label>
            <label class="inline-flex items-center gap-2 col-span-full">
              <input type="checkbox" id="noAllergies" name="allergies" value="none" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded" />
              <span>No allergies</span>
            </label>
          </div>
        </fieldset>

        <!-- Ratings -->
        <fieldset class="p-4 bg-gray-50 dark:bg-gray-800 rounded-xl" aria-labelledby="ratingLegend">
          <h3 id="ratingLegend" class="font-medium">Quick self-rating</h3>
          <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">
            Rate how you feel right now on a scale of 1 (low) to 5 (high).
          </p>

          <div class="mt-4 grid gap-4">
            <!-- Energy -->
            <div>
              <label class="block text-sm font-medium">Energy</label>
              <div class="flex items-center gap-2 mt-2">
                <div class="flex gap-2 items-center" role="radiogroup" aria-label="Energy rating"></div>
                <div class="ml-auto text-sm text-gray-500 self-center" id="energyVal">3</div>
              </div>
              <div class="mt-2" id="energyRadios"></div>
            </div>

            <!-- Focus -->
            <div>
              <label class="block text-sm font-medium">Focus</label>
              <div class="flex items-center gap-2 mt-2">
                <div class="flex gap-2 items-center" role="radiogroup" aria-label="Focus rating"></div>
                <div class="ml-auto text-sm text-gray-500 self-center" id="focusVal">3</div>
              </div>
              <div class="mt-2" id="focusRadios"></div>
            </div>

            <!-- Mood -->
            <div>
              <label class="block text-sm font-medium">Mood</label>
              <div class="flex items-center gap-2 mt-2">
                <div class="flex gap-2 items-center" role="radiogroup" aria-label="Mood rating"></div>
                <div class="ml-auto text-sm text-gray-500 self-center" id="moodVal">3</div>
              </div>
              <div class="mt-2" id="moodRadios"></div>
            </div>
          </div>
        </fieldset>

        <div class="flex gap-3 items-center">
          <button type="submit" class="inline-flex items-center justify-center gap-2 px-4 py-2 rounded-xl bg-indigo-600 text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">Get Recommendation</button>
          <button type="button" id="resetBtn" class="px-3 py-2 rounded-xl border dark:border-gray-700 text-sm">Reset</button>
        </div>
      </form>

      <!-- Result area -->
      <div id="result" class="mt-6 hidden">
        <div class="rounded-xl p-4 bg-gradient-to-r from-white to-gray-50 dark:from-gray-900 dark:to-gray-900/60 border dark:border-gray-800 shadow-sm">
          <h2 class="text-lg font-semibold" id="resultTitle">Your Recommendation</h2>
          <p class="mt-2 text-sm text-gray-600 dark:text-gray-400" id="resultReason"></p>

          <div class="mt-4 grid gap-3 sm:grid-cols-2">
            <div class="p-4 rounded-xl bg-white dark:bg-gray-800 border dark:border-gray-700 shadow-sm">
              <h3 class="font-medium">Mix Variant</h3>
              <p class="mt-1 text-sm" id="variantName"></p>
              <ul class="mt-2 text-sm list-disc list-inside text-gray-600 dark:text-gray-400" id="variantIngredients"></ul>
            </div>
            <div class="p-4 rounded-xl bg-white dark:bg-gray-800 border dark:border-gray-700 shadow-sm">
              <h3 class="font-medium">Why this fits</h3>
              <p class="mt-1 text-sm text-gray-600 dark:text-gray-400" id="variantWhy"></p>
              <div class="mt-3 flex gap-2">
                <button id="copyBtn" class="px-3 py-1 rounded-lg border text-sm">Copy recipe</button>
                <button id="saveBtn" class="px-3 py-1 rounded-lg border text-sm">Save to local data</button>
              </div>
            </div>
          </div>

          <div class="mt-4 text-sm text-gray-500">You can show this recommendation to the volunteers preparing your snack bags. Allergen-safe alternatives will be used where necessary.</div>
        </div>

        <!-- aggregate stats -->
        <div class="mt-4 p-4 rounded-xl bg-white dark:bg-gray-800 border dark:border-gray-700 shadow-sm">
          <h3 class="font-medium">Festival summary (local)</h3>
          <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">This panel shows aggregate results stored on this device (localStorage).</p>
          <div class="mt-3 text-sm space-y-2" id="summaryArea">
            <div id="mostCommon"></div>
            <div id="avgScores"></div>
          </div>
          <div class="mt-3 flex gap-2">
            <button id="clearData" class="px-3 py-1 rounded-lg border text-sm">Clear data</button>
          </div>
        </div>
      </div>
    </section>
    <footer class="text-center text-xs text-gray-500 dark:text-gray-400 mt-4">Not medical advice. For demonstration and educational purposes.</footer>
  </main>

  <!-- Back to Top button -->
  <button id="backToTop"
    class="hidden fixed bottom-6 right-6 w-12 h-12 flex items-center justify-center rounded-full bg-indigo-600 text-white shadow-lg hover:bg-indigo-700 dark:bg-gray-700 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-400"
    aria-label="Back to top">
    ↑
  </button>

  <script>
    // ---------- Utility & Accessibility Helpers ----------
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

    // Theme: respect system, allow toggle
    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    const root = document.documentElement;
    function applyInitialTheme() {
      const saved = localStorage.getItem('fm-theme');
      if (saved) {
        if (saved === 'dark') root.classList.add('dark');
        else root.classList.remove('dark');
        $('#themeToggle').setAttribute('aria-pressed', saved === 'dark');
      } else {
        if (prefersDark) root.classList.add('dark');
        else root.classList.remove('dark');
        $('#themeToggle').setAttribute('aria-pressed', prefersDark);
      }
    }
    applyInitialTheme();
    $('#themeToggle').addEventListener('click', () => {
      const isDark = root.classList.toggle('dark');
      localStorage.setItem('fm-theme', isDark ? 'dark' : 'light');
      $('#themeToggle').setAttribute('aria-pressed', isDark);
    });

    // ---------- Build rating radios dynamically ----------
    function buildRadios(containerId, name, defaultValue = 3) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      for (let i=1;i<=5;i++){
        const id = `${name}-${i}`;
        const radio = document.createElement('input');
        radio.type = 'radio'; radio.name = name; radio.value = String(i);
        radio.id = id; radio.className = 'sr-only rating-radio';
        if (i===defaultValue) radio.checked = true;

        const label = document.createElement('label');
        label.setAttribute('for', id);
        label.className = 'inline-flex items-center justify-center w-12 h-12 mx-1 rounded-xl border dark:border-gray-700 cursor-pointer select-none transition-colors';
        label.textContent = i;
        label.setAttribute('aria-hidden','true');

        radio.addEventListener('change', () => {
          $(`#${name}Val`).textContent = i;
          Array.from(container.querySelectorAll('label')).forEach(l=>l.classList.remove('bg-indigo-50','dark:bg-indigo-800','border-indigo-400'));
          label.classList.add('bg-indigo-50','dark:bg-indigo-800','border-indigo-400');
        });

        container.appendChild(radio);
        container.appendChild(label);

        if (i===defaultValue) label.classList.add('bg-indigo-50','dark:bg-indigo-800','border-indigo-400');
      }
    }

    buildRadios('energyRadios','energy',3);
    buildRadios('focusRadios','focus',3);
    buildRadios('moodRadios','mood',3);

    // ---------- Form handling & recommendation logic ----------
    const form = $('#mixForm');
    const result = $('#result');

    const VARIANTS = [
      {
        id: 'brain-boost',
        name: 'Brain Boost',
        ingredients: ['Rolled oats','Almonds (or sunflower seeds)','Dark chocolate (or carob)','Dried blueberries'],
        reason: 'Higher focus needs + antioxidants to support cognitive performance.'
      },
      {
        id: 'calm-focus',
        name: 'Calm Focus',
        ingredients: ['Rolled oats','Cashews (or sunflower seeds)','Dried cranberries','A pinch of matcha (optional)'],
        reason: 'Support for stress reduction and sustained attention with magnesium and healthy fats.'
      },
      {
        id: 'energy-kick',
        name: 'Energy Kick',
        ingredients: ['Rolled oats','Mixed seeds','Dried fruit mix','Small dark chocolate pieces (optional)'],
        reason: 'Quick sense of energy from natural sugars and slow-release oats for longer support.'
      }
    ];

    function chooseVariant(scores, allergies) {
      const {energy, focus, mood} = scores;
      let choice = VARIANTS[0];
      if (energy <= 2 && energy < focus && energy < mood) choice = VARIANTS[2];
      else if (focus <= 2 && focus <= mood) choice = VARIANTS[0];
      else if (mood <= 2 && mood < focus) choice = VARIANTS[1];
      else {
        const min = Math.min(energy, focus, mood);
        if (min === energy) choice = VARIANTS[2];
        else if (min === focus) choice = VARIANTS[0];
        else choice = VARIANTS[1];
      }

      let ingredients = choice.ingredients.map(i => i);
      if (allergies.includes('nuts')) {
        ingredients = ingredients.map(i => i.replace(/Almonds|Cashews|Nuts/gi,'Sunflower seeds'));
      }
      if (allergies.includes('chocolate')) {
        ingredients = ingredients.map(i => i.replace(/Dark chocolate|chocolate/gi,'Carob chips'));
      }
      if (allergies.includes('driedfruit')) {
        ingredients = ingredients.map(i => i.replace(/Dried blueberries|Dried cranberries|Dried fruit/gi,'Unsweetened apple bits'));
      }
      if (allergies.includes('matcha')) {
        ingredients = ingredients.map(i => i.replace(/matcha|Matcha/gi,'(no caffeine)'));
      }

      return { variant: choice, ingredients };
    }

    function getFormValues() {
      const checked = Array.from(form.querySelectorAll('input[name="allergies"]:checked')).map(i=>i.value);
      const allergies = checked.includes('none') ? [] : checked;
      const energy = Number(form.querySelector('input[name="energy"]:checked').value);
      const focus = Number(form.querySelector('input[name="focus"]:checked').value);
      const mood = Number(form.querySelector('input[name="mood"]:checked').value);
      return { allergies, scores: {energy, focus, mood} };
    }

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      try {
        const { allergies, scores } = getFormValues();
        if (allergies.includes('none') && allergies.length > 1) {
          alert('If you selected "No allergies", please uncheck other allergy boxes.');
          return;
        }
        displayRecommendation(scores, allergies);
      } catch (err) {
        alert('Please complete the form (choose ratings and confirm allergy choices).');
      }
    });

    $('#resetBtn').addEventListener('click', () => {
      form.reset();
      buildRadios('energyRadios','energy',3);
      buildRadios('focusRadios','focus',3);
      buildRadios('moodRadios','mood',3);
      result.classList.add('hidden');
    });

    function displayRecommendation(scores, allergies) {
      const { variant, ingredients } = chooseVariant(scores, allergies);
      $('#variantName').textContent = variant.name;
      $('#variantIngredients').innerHTML = '';
      ingredients.forEach(i => {
        const li = document.createElement('li'); li.textContent = i; $('#variantIngredients').appendChild(li);
      });
      $('#variantWhy').textContent = variant.reason;
      $('#resultReason').textContent = `Based on your ratings (Energy: ${scores.energy}, Focus: ${scores.focus}, Mood: ${scores.mood}) and allergy choices, here is a recommended mix.`;
      result.classList.remove('hidden');

      $('#copyBtn').onclick = () => {
        const text = `${variant.name}\nIngredients:\n- ${ingredients.join('\n- ')}`;
        navigator.clipboard?.writeText(text).then(()=>alert('Recipe copied to clipboard.'));
      };

      $('#saveBtn').onclick = () => {
        saveLocalResult({timestamp: Date.now(), scores, allergies, variant: variant.id});
        renderSummary();
        alert('Saved locally.');
      };

      renderSummary();
    }

    // ---------- Local aggregation ----------
    const STORAGE_KEY = 'focusmix-data-v1';
    function loadLocalData() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      } catch (e) { return []; }
    }
    function saveLocalResult(entry) {
      const data = loadLocalData();
      data.push(entry);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }
    function clearLocalData() {
      localStorage.removeItem(STORAGE_KEY);
      renderSummary();
    }

    function renderSummary() {
      const data = loadLocalData();
      if (data.length === 0) {
        $('#summaryArea').innerHTML = '<div class="text-sm text-gray-500">No saved entries yet. Use "Save to local data" after getting a recommendation.</div>';
        return;
      }
      const avg = data.reduce((acc,d)=>{ acc.energy+=d.scores.energy; acc.focus+=d.scores.focus; acc.mood+=d.scores.mood; return acc; },{energy:0,focus:0,mood:0});
      avg.energy = (avg.energy / data.length).toFixed(2);
      avg.focus = (avg.focus / data.length).toFixed(2);
      avg.mood = (avg.mood / data.length).toFixed(2);

      const counts = {};
      data.forEach(d=> counts[d.variant] = (counts[d.variant]||0)+1);
      const sorted = Object.entries(counts).sort((a,b)=>b[1]-a[1]);
      const mostCommon = sorted[0] ? sorted[0][0] : '—';
      const variantName = VARIANTS.find(v=>v.id===mostCommon)?.name || 'Mixed';

      $('#mostCommon').innerHTML = `<strong>Most recommended mix:</strong> ${variantName} (${counts[mostCommon] || 0} participants)`;
      $('#avgScores').innerHTML = `<strong>Average ratings:</strong> Energy ${avg.energy} · Focus ${avg.focus} · Mood ${avg.mood} (from ${data.length} entries)`;
      $('#clearData').onclick = () => { if (confirm('Clear local saved data?')) clearLocalData(); };
    }

    renderSummary();

    // ---------- Back to Top button ----------
    const backToTop = document.getElementById('backToTop');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 200) {
        backToTop.classList.remove('hidden');
      } else {
        backToTop.classList.add('hidden');
      }
    });
    backToTop.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    const noAllergies = document.getElementById("noAllergies");
    const allergyOptions = document.querySelectorAll("input.allergy");

    noAllergies.addEventListener("change", function () {
      if (this.checked) {
        allergyOptions.forEach(opt => {
          opt.checked = false;
          opt.disabled = true;
        });
      } else {
        allergyOptions.forEach(opt => opt.disabled = false);
      }
    });

    allergyOptions.forEach(opt => {
      opt.addEventListener("change", function () {
        if (this.checked) {
          noAllergies.checked = false;
        }
      });
    });
  </script>
</body>
</html>
